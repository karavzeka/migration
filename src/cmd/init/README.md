# Инициализация существующей БД
```
make init <db_alias> [dry]
```
Команда `init` создает инициализирующую миграцию с полным снимком текущей структуры БД. Параметры коннекта к БД берутся из файла `databases/<db_alias>/.env`.

Будет создана и заполнена sql командами пара файлов up/down с версией 1. В самой базе данных будет создана таблица `schema_migrations`, в которую пропишется версия 1.

Если в папке с миграциями уже существуют какие-то файлы, то произойдет ошибка, и инициализация не будет выполнена.

`dry` - необязательный параметр. При его указании создадутся только файлы up/down, в самой базе данных таблица `schema_migrations` не будет создана.

### Пример
Перейти в папку с проектом, запустить докер с тестовыми postgres и mysql:
```
docker-compose up -d
```

Сначала надо наполнить тестовую БД таблицами. Это можно сделать вручную, а можно выполнить миграцию из папки `pgsql`, где лежат примеры файлов с миграциями (`.env` уже настроен на тестовый postgres):
```
make migrate pgsql up
```

Теперь представим, что создаем нову миграцию на основе существующей БД. Для этого сначала создадим новую папку `new_pg_db`, потом скопируем туда образец файла с окружением, уже настроенный на тестовую базу postgres (ту же самую, которую заполнили выше), и наконец запустим команду инициализации.
```
mkdir databases/new_pg_db
cp .env-example databases/new_pg_db/.env
make init new_pg_db
```